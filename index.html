<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>App Crist√£o</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0B1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="App Crist√£o">

  <style>
    :root{
      --bg:#070B14;
      --card:#0B1220;
      --line:rgba(255,255,255,.10);
      --text:#EAF0FF;
      --muted:#A7B4D6;
      --btn:#111C33;
      --shadow: 0 14px 35px rgba(0,0,0,.35);
      --radius:18px;
      --good:#45E2A8;
      --warn:#FFD36E;
      --bad:#FF6B6B;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 600px at 30% -10%, rgba(90,140,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 100% 10%, rgba(69,226,168,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:14px 16px 10px;
      backdrop-filter: blur(16px);
      background: linear-gradient(to bottom, rgba(7,11,20,.92), rgba(7,11,20,.65));
      border-bottom:1px solid var(--line);
    }
    .top{display:flex; align-items:center; justify-content:space-between; gap:12px; max-width:980px; margin:0 auto;}
    .brand{display:flex; gap:10px; align-items:center}
    .logo{
      width:40px; height:40px; border-radius:14px;
      background: linear-gradient(135deg, rgba(90,140,255,.9), rgba(69,226,168,.8));
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      font-size:20px;
    }
    .titles b{display:block; font-size:16px; line-height:1.1}
    .titles span{color:var(--muted); font-size:12px}
    .pill{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      display:flex; gap:8px; align-items:center;
      max-width:55%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .wrap{max-width:980px; margin:0 auto; padding:14px 16px 96px}
    .grid{display:grid; grid-template-columns:1.25fr .75fr; gap:12px}
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .hero{
      background: radial-gradient(700px 350px at 15% 0%, rgba(90,140,255,.22), transparent 60%),
                  radial-gradient(600px 300px at 95% 10%, rgba(69,226,168,.18), transparent 60%),
                  rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:16px;
    }
    .card h2{margin:0 0 10px; font-size:14px; letter-spacing:.2px; color:var(--muted); font-weight:700}
    .verse{font-size:20px; line-height:1.35; margin:0 0 10px}
    .ref{color:var(--muted); font-size:13px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:1px solid var(--line);
      background: var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:650;
      font-size:14px;
    }
    button.primary{background: linear-gradient(135deg, rgba(90,140,255,.35), rgba(69,226,168,.26));}
    button.ghost{background: rgba(255,255,255,.05);}
    button.danger{background: rgba(255,107,107,.12);}
    button:active{transform:scale(.99)}
    .item{
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
    }
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .row .left{min-width:0}
    .row .left b{display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .row .left span{color:var(--muted); font-size:12px}
    .tiny{font-size:12px; color:var(--muted)}
    .ok{color:var(--good); font-weight:800}
    input, textarea{
      width:100%;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}
    .list{display:flex; flex-direction:column; gap:10px}
    .split{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:520px){ .split{grid-template-columns:1fr} }
    .tabs{
      position:fixed; left:0; right:0; bottom:0;
      background: rgba(7,11,20,.85);
      border-top:1px solid var(--line);
      backdrop-filter: blur(16px);
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      display:flex; gap:8px; justify-content:space-between;
    }
    .tab{
      flex:1;
      display:flex; flex-direction:column; align-items:center; gap:6px;
      padding:8px 6px;
      border-radius:16px;
      border:1px solid transparent;
      color:var(--muted);
      font-size:11px;
      user-select:none;
    }
    .tab.active{
      color:var(--text);
      background: rgba(255,255,255,.06);
      border-color: var(--line);
    }
    .tab i{font-style:normal; font-size:18px}
    .gallery{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:10px;
      margin-top:12px;
    }
    .gallery img{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      object-fit:cover;
      aspect-ratio: 1 / 1;
    }
  </style>
</head>

<body>
<header>
  <div class="top">
    <div class="brand">
      <div class="logo">‚úùÔ∏è</div>
      <div class="titles">
        <b>App Crist√£o</b>
        <span>Vers√≠culo ‚Ä¢ M√∫sica ‚Ä¢ Ora√ß√£o ‚Ä¢ Imagens</span>
      </div>
    </div>
    <div class="pill" id="statusPill">‚è≥ Preparando‚Ä¶</div>
  </div>
</header>

<div class="wrap">
  <section id="view-hoje">
    <div class="grid">
      <div class="card hero">
        <h2>HOJE</h2>
        <p class="verse" id="verseText">‚Ä¶</p>
        <div class="ref" id="verseRef">‚Ä¶</div>

        <div class="actions">
          <button class="primary" onclick="nextVerse()">Trocar</button>
          <button class="ghost" onclick="copyVerse()">Copiar</button>
        </div>

        <div class="item" style="margin-top:12px">
          <b class="tiny">Devocional</b>
          <div class="tiny" id="devText" style="margin-top:8px">‚Ä¶</div>
        </div>
      </div>

      <div class="card">
        <h2>TIMER DE ORA√á√ÉO</h2>
        <div class="item">
          <div class="row">
            <b id="timerShow">00:00</b>
            <span class="tiny" id="timerMsg"></span>
          </div>
          <div class="actions" style="margin-top:10px">
            <button onclick="startTimer(5)">5 min</button>
            <button onclick="startTimer(10)">10 min</button>
            <button onclick="startTimer(15)">15 min</button>
            <button class="ghost" onclick="stopTimer()">Parar</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="view-musica" style="display:none">
    <div class="card">
      <h2>M√öSICA</h2>
      <div class="item">
        <div class="split">
          <input id="musicUrl" placeholder="Cole um link MP3 (opcional)"/>
          <button class="primary" onclick="playUrl()">Tocar</button>
        </div>
        <div class="tiny" style="margin-top:8px">Ou escolha um √°udio do iPhone:</div>
        <input type="file" accept="audio/*" onchange="playFile(this.files[0])" style="margin-top:10px"/>
        <audio id="player" controls style="width:100%; margin-top:12px;"></audio>
      </div>
    </div>
  </section>

  <section id="view-oracao" style="display:none">
    <div class="card">
      <h2>PEDIDOS DE ORA√á√ÉO</h2>
      <div class="item">
        <div class="split">
          <input id="prTitle" placeholder="T√≠tulo (ex: Fam√≠lia)"/>
          <button class="primary" onclick="addPrayer()">Adicionar</button>
        </div>
        <textarea id="prText" placeholder="Escreva o pedido‚Ä¶"></textarea>
      </div>
      <div class="list" id="prList" style="margin-top:12px"></div>
    </div>
  </section>

  <section id="view-imagens" style="display:none">
    <div class="card">
      <h2>IMAGENS</h2>
      <div class="item">
        <input type="file" accept="image/*" multiple onchange="saveImages(this.files)" />
        <div class="actions" style="margin-top:10px">
          <button class="ghost" onclick="clearImages()">Apagar todas</button>
        </div>
      </div>
      <div class="gallery" id="gallery"></div>
    </div>
  </section>
</div>

<nav class="tabs">
  <div class="tab active" id="tab-hoje" onclick="show('hoje')"><i>üè†</i>Hoje</div>
  <div class="tab" id="tab-musica" onclick="show('musica')"><i>üéµ</i>M√∫sica</div>
  <div class="tab" id="tab-oracao" onclick="show('oracao')"><i>üôè</i>Pedidos</div>
  <div class="tab" id="tab-imagens" onclick="show('imagens')"><i>üñºÔ∏è</i>Imagens</div>
</nav>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }

  const store = {
    get(k, fallback){ try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch { return fallback; } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); },
  };

  function show(which){
    const views = ['hoje','musica','oracao','imagens'];
    for (const v of views){
      document.getElementById('view-'+v).style.display = (v===which) ? 'block' : 'none';
      document.getElementById('tab-'+v).classList.toggle('active', v===which);
    }
  }

  const verses = [
    {ref:"Salmo 23:1", text:"O Senhor √© o meu pastor; nada me faltar√°."},
    {ref:"Mateus 6:33", text:"Buscai primeiro o Reino de Deus e a sua justi√ßa, e todas essas coisas vos ser√£o acrescentadas."},
    {ref:"Filipenses 4:6", text:"N√£o andeis ansiosos por coisa alguma; em tudo, por√©m, sejam conhecidas diante de Deus as vossas peti√ß√µes."},
    {ref:"Isa√≠as 41:10", text:"N√£o temas, porque eu sou contigo; n√£o te assombres, porque eu sou o teu Deus."}
  ];

  const devotionals = [
    "Hoje, confie antes de entender. Deus guia um passo por vez.",
    "Ore simples e continue. A paz de Cristo √© maior que o medo.",
    "Deus fortalece o cora√ß√£o humilde. Persevere.",
    "Mesmo no sil√™ncio, Deus est√° trabalhando por voc√™."
  ];

  function dayOfYear(d=new Date()){
    const start = new Date(d.getFullYear(), 0, 0);
    return Math.floor((d - start) / 86400000);
  }

  let verseIndex = store.get('verseIndex', (dayOfYear()-1) % verses.length);

  function renderVerse(){
    const v = verses[verseIndex];
    document.getElementById('verseText').textContent = "‚Äú" + v.text + "‚Äù";
    document.getElementById('verseRef').textContent = v.ref;
    document.getElementById('devText').textContent = devotionals[dayOfYear() % devotionals.length];
    store.set('verseIndex', verseIndex);
    updateStatus();
  }

  function nextVerse(){
    verseIndex = (verseIndex + 1) % verses.length;
    renderVerse();
  }

  async function copyVerse(){
    const v = verses[verseIndex];
    const txt = `${v.text} ‚Äî ${v.ref}`;
    try { await navigator.clipboard.writeText(txt); } catch { alert(txt); }
  }

  let timer=null, remaining=0;
  function fmt(sec){
    const m = Math.floor(sec/60), s = sec%60;
    return String(m).padStart(2,'0') + ":" + String(s).padStart(2,'0');
  }
  function tick(){
    document.getElementById('timerShow').textContent = fmt(remaining);
    if(remaining<=0){
      stopTimer();
      alert("Tempo conclu√≠do üôè");
      return;
    }
    remaining--;
  }
  function startTimer(min){
    stopTimer();
    remaining = min*60;
    document.getElementById('timerMsg').textContent = `Rodando: ${min} min`;
    tick();
    timer = setInterval(tick, 1000);
  }
  function stopTimer(){
    if(timer){ clearInterval(timer); timer=null; }
    document.getElementById('timerMsg').textContent = "";
  }

  function esc(s){ return (s??'').toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

  function getPrayers(){ return store.get('prayers', []); }
  function setPrayers(arr){ store.set('prayers', arr); renderPrayers(); updateStatus(); }

  function addPrayer(){
    const title = document.getElementById('prTitle').value.trim() || "Pedido";
    const details = document.getElementById('prText').value.trim();
    const arr = getPrayers();
    arr.unshift({id: crypto.randomUUID(), title, details, date: new Date().toISOString()});
    setPrayers(arr);
    document.getElementById('prTitle').value="";
    document.getElementById('prText').value="";
  }

  function delPrayer(id){
    if (!confirm("Apagar este pedido?")) return;
    setPrayers(getPrayers().filter(p=>p.id!==id));
  }

  function renderPrayers(){
    const el = document.getElementById('prList');
    const arr = getPrayers();
    if (!arr.length){
      el.innerHTML = `<div class="item"><b>Nenhum pedido ainda</b><div class="tiny">Adicione o primeiro acima.</div></div>`;
      return;
    }
    el.innerHTML = arr.map(p=>`
      <div class="item">
        <div class="row">
          <div class="left">
            <b>${esc(p.title)}</b>
            <span class="tiny">${new Date(p.date).toLocaleString()}</span>
          </div>
          <button class="danger" onclick="delPrayer('${p.id}')">Apagar</button>
        </div>
        ${p.details ? `<div class="tiny" style="margin-top:10px; white-space:pre-wrap">${esc(p.details)}</div>` : ''}
      </div>
    `).join('');
  }

  function playUrl(){
    const url = document.getElementById('musicUrl').value.trim();
    if(!url) return alert("Cole um link MP3 primeiro (opcional).");
    const player = document.getElementById('player');
    player.src = url;
    player.play().catch(()=>{});
  }

  function playFile(file){
    if(!file) return;
    const player = document.getElementById('player');
    player.src = URL.createObjectURL(file);
    player.play().catch(()=>{});
  }

  function getImages(){ return store.get('images', []); }
  function setImages(arr){ store.set('images', arr); renderImages(); }

  function fileToBase64(file){
    return new Promise((resolve, reject)=>{
      const r = new FileReader();
      r.onload = ()=> resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  async function saveImages(files){
    if(!files || !files.length) return;
    const arr = getImages();
    for(const f of files){
      const base64 = await fileToBase64(f);
      arr.unshift(base64);
    }
    setImages(arr);
  }

  function clearImages(){
    if(!confirm("Apagar todas as imagens?")) return;
    setImages([]);
  }

  function renderImages(){
    const el = document.getElementById('gallery');
    const arr = getImages();
    el.innerHTML = arr.map(src=> `<img src="${src}">`).join('');
  }

  function updateStatus(){
    const prayers = getPrayers().length;
    document.getElementById('statusPill').textContent = prayers ? `üôè ${prayers} pedidos salvos` : "üü¢ Tudo certo";
  }

  renderVerse();
  renderPrayers();
  renderImages();
  updateStatus();
</script>
</body>
</html>
