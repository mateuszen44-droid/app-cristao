<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>App Crist√£o</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0B1220">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="App Crist√£o">

  <style>
    :root{
      --bg:#070B14;
      --card:#0B1220;
      --card2:#0F1A2E;
      --text:#EAF0FF;
      --muted:#A7B4D6;
      --line:rgba(255,255,255,.10);
      --btn:#111C33;
      --btn2:#16274A;
      --good:#45E2A8;
      --warn:#FFD36E;
      --bad:#FF6B6B;
      --shadow: 0 14px 35px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 600px at 30% -10%, rgba(90,140,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 100% 10%, rgba(69,226,168,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      padding:14px 16px 10px;
      backdrop-filter: blur(16px);
      background: linear-gradient(to bottom, rgba(7,11,20,.92), rgba(7,11,20,.65));
      border-bottom:1px solid var(--line);
    }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      max-width:980px; margin:0 auto;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
    }
    .logo{
      width:40px; height:40px; border-radius:14px;
      background: linear-gradient(135deg, rgba(90,140,255,.9), rgba(69,226,168,.8));
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      font-size:20px;
    }
    .titles b{display:block; font-size:16px; line-height:1.1}
    .titles span{color:var(--muted); font-size:12px}
    .pill{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      display:flex; gap:8px; align-items:center;
    }
    .wrap{max-width:980px; margin:0 auto; padding:14px 16px 96px}
    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:12px;
    }
    @media (max-width: 860px){ .grid{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card h2{margin:0 0 10px; font-size:14px; letter-spacing:.2px; color:var(--muted); font-weight:700}
    .hero{
      background: radial-gradient(700px 350px at 15% 0%, rgba(90,140,255,.22), transparent 60%),
                  radial-gradient(600px 300px at 95% 10%, rgba(69,226,168,.18), transparent 60%),
                  rgba(255,255,255,.03);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:16px;
    }
    .verse{
      font-size:20px; line-height:1.35; margin:0 0 10px;
    }
    .ref{color:var(--muted); font-size:13px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:1px solid var(--line);
      background: var(--btn);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:650;
      font-size:14px;
    }
    button.primary{background: linear-gradient(135deg, rgba(90,140,255,.35), rgba(69,226,168,.26));}
    button.ghost{background: rgba(255,255,255,.05);}
    button:active{transform:scale(.99)}
    .mini{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
      color:var(--muted); font-size:12px;
    }
    .dev{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
    }
    .dev b{display:block; margin-bottom:6px}
    .list{display:flex; flex-direction:column; gap:10px}
    .item{
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
    }
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .row .left{min-width:0}
    .row .left b{display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .row .left span{color:var(--muted); font-size:12px}
    .tag{font-size:12px; color:var(--muted)}
    .ok{color:var(--good); font-weight:800}
    .warn{color:var(--warn); font-weight:800}
    input, textarea{
      width:100%;
      background: rgba(255,255,255,.04);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}
    .tabs{
      position:fixed; left:0; right:0; bottom:0;
      background: rgba(7,11,20,.85);
      border-top:1px solid var(--line);
      backdrop-filter: blur(16px);
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      display:flex; gap:8px; justify-content:space-between;
    }
    .tab{
      flex:1;
      display:flex; flex-direction:column; align-items:center; gap:6px;
      padding:8px 6px;
      border-radius:16px;
      border:1px solid transparent;
      color:var(--muted);
      font-size:11px;
    }
    .tab.active{
      color:var(--text);
      background: rgba(255,255,255,.06);
      border-color: var(--line);
    }
    .tab i{font-style:normal; font-size:18px}
    .split{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:520px){ .split{grid-template-columns:1fr} }
    .tiny{font-size:12px; color:var(--muted)}
    .danger{background: rgba(255,107,107,.12)}
  </style>
</head>

<body>
<header>
  <div class="top">
    <div class="brand">
      <div class="logo">‚úùÔ∏è</div>
      <div class="titles">
        <b>App Crist√£o</b>
        <span>Seu devocional pessoal ‚Ä¢ offline</span>
      </div>
    </div>
    <div class="pill" id="statusPill">‚è≥ Preparando‚Ä¶</div>
  </div>
</header>

<div class="wrap">
  <!-- HOJE -->
  <section id="view-hoje">
    <div class="grid">
      <div class="card hero">
        <h2>HOJE</h2>
        <p class="verse" id="verseText">‚Ä¶</p>
        <div class="ref" id="verseRef">‚Ä¶</div>

        <div class="actions">
          <button class="primary" onclick="nextVerse()">Trocar</button>
          <button class="ghost" onclick="shareVerse()">Compartilhar</button>
          <button class="ghost" onclick="copyVerse()">Copiar</button>
        </div>

        <div class="dev">
          <b id="devTitle">Devocional (1 minuto)</b>
          <div class="tiny" id="devText">‚Ä¶</div>
        </div>

        <div class="mini">
          <span>üíæ Salva no seu iPhone</span>
          <span>üì¥ Funciona offline</span>
          <span>üïñ Lembrete: Atalhos</span>
        </div>
      </div>

      <div class="card">
        <h2>PLANO DE LEITURA</h2>
        <div class="item">
          <div class="row">
            <div class="left">
              <b id="planTitle">Plano ‚Äú30 dias‚Äù</b>
              <span id="planSubtitle">Dia ‚Ä¶</span>
            </div>
            <div class="tag" id="planPct">0%</div>
          </div>
          <div class="actions" style="margin-top:10px">
            <button class="primary" onclick="markTodayDone()">Marcar ‚Äúfeito‚Äù</button>
            <button class="ghost" onclick="resetPlan()">Reiniciar</button>
          </div>
          <div class="tiny" style="margin-top:10px" id="planTodayText"></div>
        </div>

        <div class="item" style="margin-top:10px">
          <div class="row">
            <div class="left">
              <b>Checklist da semana</b>
              <span>Vit√≥rias pequenas, const√¢ncia grande</span>
            </div>
            <span class="ok" id="weekDone">0/7</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ORA√á√ÉO -->
  <section id="view-oracao" style="display:none">
    <div class="card">
      <h2>ORA√á√ÉO</h2>

      <div class="split">
        <input id="prTitle" placeholder="T√≠tulo (ex: Fam√≠lia)"/>
        <button class="primary" onclick="addPrayer()">Adicionar</button>
      </div>
      <textarea id="prText" placeholder="Detalhes do pedido‚Ä¶"></textarea>

      <div class="list" id="prList" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- NOTAS -->
  <section id="view-notas" style="display:none">
    <div class="card">
      <h2>ANOTA√á√ïES</h2>
      <div class="split">
        <input id="noteTitle" placeholder="T√≠tulo (ex: Serm√£o)"/>
        <button class="primary" onclick="addNote()">Salvar</button>
      </div>
      <textarea id="noteText" placeholder="Escreva aqui‚Ä¶"></textarea>
      <div class="list" id="noteList" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- CONFIG -->
  <section id="view-config" style="display:none">
    <div class="card">
      <h2>CONFIG / BACKUP</h2>

      <div class="item">
        <div class="row">
          <div class="left">
            <b>Backup (exportar)</b>
            <span>Gera um arquivo com suas notas e ora√ß√µes</span>
          </div>
          <button class="ghost" onclick="exportData()">Exportar</button>
        </div>
      </div>

      <div class="item" style="margin-top:10px">
        <div class="row">
          <div class="left">
            <b>Importar backup</b>
            <span>Restaura seus dados</span>
          </div>
          <input type="file" id="importFile" accept="application/json" onchange="importData(this.files[0])">
        </div>
      </div>

      <div class="item danger" style="margin-top:10px">
        <div class="row">
          <div class="left">
            <b>Apagar tudo</b>
            <span>Remove notas, ora√ß√µes e progresso</span>
          </div>
          <button onclick="wipeAll()">Apagar</button>
        </div>
      </div>

      <div class="tiny" style="margin-top:12px">
        ‚ÑπÔ∏è Dica: para lembrete 07:00, crie uma Automa√ß√£o no app <b>Atalhos</b> (eu te explico abaixo).
      </div>
    </div>
  </section>
</div>

<!-- Bottom tabs -->
<nav class="tabs">
  <div class="tab active" id="tab-hoje" onclick="show('hoje')"><i>üè†</i>Hoje</div>
  <div class="tab" id="tab-oracao" onclick="show('oracao')"><i>üôè</i>Ora√ß√£o</div>
  <div class="tab" id="tab-notas" onclick="show('notas')"><i>üìù</i>Notas</div>
  <div class="tab" id="tab-config" onclick="show('config')"><i>‚öôÔ∏è</i>Config</div>
</nav>

<script>
  // ---------- Service worker (offline) ----------
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }

  // ---------- Data store ----------
  const store = {
    get(k, fallback){ try { return JSON.parse(localStorage.getItem(k)) ?? fallback; } catch { return fallback; } },
    set(k, v){ localStorage.setItem(k, JSON.stringify(v)); },
  };

  // ---------- Content ----------
  const verses = [
    {ref:"Salmo 23:1", text:"O Senhor √© o meu pastor; nada me faltar√°."},
    {ref:"Mateus 6:33", text:"Buscai primeiro o Reino de Deus e a sua justi√ßa, e todas essas coisas vos ser√£o acrescentadas."},
    {ref:"Filipenses 4:6", text:"N√£o andeis ansiosos por coisa alguma; em tudo, por√©m, sejam conhecidas diante de Deus as vossas peti√ß√µes."},
    {ref:"Isa√≠as 41:10", text:"N√£o temas, porque eu sou contigo; n√£o te assombres, porque eu sou o teu Deus."},
    {ref:"Romanos 8:28", text:"Todas as coisas cooperam para o bem daqueles que amam a Deus."},
    {ref:"Jo√£o 14:27", text:"Deixo-vos a paz, a minha paz vos dou; n√£o vo-la dou como o mundo a d√°."},
    {ref:"Prov√©rbios 3:5", text:"Confia no Senhor de todo o teu cora√ß√£o e n√£o te estribes no teu pr√≥prio entendimento."},
  ];

  const devotionals = [
    {title:"Confian√ßa", text:"Hoje, escolha confiar antes de entender. Deus guia um passo por vez. Fa√ßa o que voc√™ pode, entregue o que voc√™ n√£o controla e permane√ßa firme."},
    {title:"Paz", text:"A paz de Cristo n√£o depende das circunst√¢ncias. Respire, ore simples, e siga. A paz √© um presente ‚Äî receba e caminhe."},
    {title:"Const√¢ncia", text:"Deus trabalha na repeti√ß√£o: um dia, uma decis√£o, um h√°bito. Pequenas obediencias constroem grandes vit√≥rias."},
    {title:"Coragem", text:"Coragem n√£o √© aus√™ncia de medo; √© fidelidade apesar do medo. D√™ o pr√≥ximo passo com Deus."},
  ];

  // Plano simples de 30 dias (sem texto b√≠blico completo, apenas refer√™ncias)
  const plan30 = [
    "Dia 1: Salmo 1", "Dia 2: Salmo 23", "Dia 3: Salmo 91", "Dia 4: Prov√©rbios 3",
    "Dia 5: Mateus 5", "Dia 6: Mateus 6", "Dia 7: Mateus 7", "Dia 8: Jo√£o 1",
    "Dia 9: Jo√£o 3", "Dia 10: Jo√£o 14", "Dia 11: Romanos 8", "Dia 12: 1 Cor√≠ntios 13",
    "Dia 13: Filipenses 4", "Dia 14: Colossenses 3", "Dia 15: Ef√©sios 6",
    "Dia 16: Tiago 1", "Dia 17: Tiago 3", "Dia 18: 1 Pedro 5", "Dia 19: 1 Jo√£o 1",
    "Dia 20: 1 Jo√£o 4", "Dia 21: Salmo 27", "Dia 22: Salmo 121", "Dia 23: Isa√≠as 40",
    "Dia 24: Isa√≠as 41", "Dia 25: Jeremias 29", "Dia 26: Lucas 15", "Dia 27: Atos 2",
    "Dia 28: Atos 4", "Dia 29: Romanos 12", "Dia 30: Apocalipse 21"
  ];

  // ---------- Verse of day ----------
  function dayOfYear(d=new Date()){
    const start = new Date(d.getFullYear(), 0, 0);
    const diff = d - start;
    return Math.floor(diff / 86400000);
  }
  let verseIndex = store.get('verseIndex', null);
  function setVerseByDay(){
    const i = (dayOfYear() - 1) % verses.length;
    verseIndex = (verseIndex === null) ? i : verseIndex;
    renderVerse();
  }
  function renderVerse(){
    const v = verses[verseIndex];
    document.getElementById('verseText').textContent = "‚Äú" + v.text + "‚Äù";
    document.getElementById('verseRef').textContent = v.ref;
    const dev = devotionals[dayOfYear() % devotionals.length];
    document.getElementById('devTitle').textContent = "Devocional: " + dev.title;
    document.getElementById('devText').textContent = dev.text;
    store.set('verseIndex', verseIndex);
  }
  function nextVerse(){
    verseIndex = (verseIndex + 1) % verses.length;
    renderVerse();
  }
  async function copyVerse(){
    const v = verses[verseIndex];
    const txt = `${v.text} ‚Äî ${v.ref}`;
    try { await navigator.clipboard.writeText(txt); toast("Copiado ‚úÖ"); } catch { alert(txt); }
  }
  async function shareVerse(){
    const v = verses[verseIndex];
    const txt = `${v.text}\n‚Äî ${v.ref}`;
    if (navigator.share) {
      try { await navigator.share({title:"Vers√≠culo", text: txt}); } catch {}
    } else {
      await copyVerse();
    }
  }

  // ---------- Plan ----------
  function getPlan(){
    return store.get('plan', {done:[], startedAt: new Date().toISOString()});
  }
  function setPlan(p){ store.set('plan', p); renderPlan(); }
  function todayIndex(){
    const p = getPlan();
    const start = new Date(p.startedAt);
    const days = Math.max(0, Math.floor((new Date() - start)/86400000));
    return Math.min(plan30.length-1, days);
  }
  function markTodayDone(){
    const p = getPlan();
    const i = todayIndex();
    if (!p.done.includes(i)) p.done.push(i);
    // Week streak: count last 7 days
    setPlan(p);
    toast("Dia marcado ‚úÖ");
  }
  function resetPlan(){
    if (!confirm("Reiniciar o plano?")) return;
    setPlan({done:[], startedAt: new Date().toISOString()});
  }
  function renderPlan(){
    const p = getPlan();
    const i = todayIndex();
    const doneCount = p.done.length;
    const pct = Math.round((doneCount/plan30.length)*100);
    document.getElementById('planSubtitle').textContent = `Dia ${i+1} de ${plan30.length}`;
    document.getElementById('planPct').textContent = `${pct}%`;
    document.getElementById('planTodayText').textContent =
      (p.done.includes(i) ? "‚úÖ Feito hoje: " : "‚è≥ Leitura de hoje: ") + plan30[i];

    // last 7 days completion
    const last7 = [];
    for(let k=0;k<7;k++){
      const idx = i-k;
      if (idx>=0) last7.push(idx);
    }
    const weekDone = last7.filter(x=>p.done.includes(x)).length;
    document.getElementById('weekDone').textContent = `${weekDone}/${last7.length}`;
  }

  // ---------- Prayer ----------
  function getPrayers(){ return store.get('prayers', []); }
  function setPrayers(arr){ store.set('prayers', arr); renderPrayers(); }
  function addPrayer(){
    const title = document.getElementById('prTitle').value.trim() || "Pedido";
    const details = document.getElementById('prText').value.trim();
    const arr = getPrayers();
    arr.unshift({id: crypto.randomUUID(), title, details, prayed:false, fav:false, updatedAt: new Date().toISOString()});
    setPrayers(arr);
    document.getElementById('prTitle').value="";
    document.getElementById('prText').value="";
    toast("Adicionado üôè");
  }
  function togglePrayed(id){
    const arr = getPrayers().map(p=>{
      if (p.id===id){ p.prayed=!p.prayed; p.updatedAt = new Date().toISOString(); }
      return p;
    });
    setPrayers(arr);
  }
  function toggleFav(id){
    const arr = getPrayers().map(p=>{
      if (p.id===id){ p.fav=!p.fav; p.updatedAt = new Date().toISOString(); }
      return p;
    });
    setPrayers(arr);
  }
  function delPrayer(id){
    if (!confirm("Apagar este pedido?")) return;
    setPrayers(getPrayers().filter(p=>p.id!==id));
  }
  function renderPrayers(){
    const el = document.getElementById('prList');
    const arr = getPrayers().slice().sort((a,b)=> (b.fav - a.fav) || (new Date(b.updatedAt)-new Date(a.updatedAt)));
    if (!arr.length){ el.innerHTML = `<div class="item"><b>Nenhum pedido ainda</b><div class="tiny">Adicione o primeiro acima.</div></div>`; return; }
    el.innerHTML = arr.map(p=>`
      <div class="item">
        <div class="row">
          <div class="left">
            <b>${esc(p.title)} ${p.prayed ? '<span class="ok">‚Ä¢ orei ‚úÖ</span>' : ''}</b>
            <span>${new Date(p.updatedAt).toLocaleString()}</span>
          </div>
          <div style="display:flex; gap:8px">
            <button class="ghost" onclick="toggleFav('${p.id}')">${p.fav ? '‚≠ê' : '‚òÜ'}</button>
            <button class="primary" onclick="togglePrayed('${p.id}')">${p.prayed ? 'Desmarcar' : 'Orei'}</button>
          </div>
        </div>
        ${p.details ? `<div class="tiny" style="margin-top:10px">${esc(p.details)}</div>` : ''}
        <div class="actions" style="margin-top:10px">
          <button class="ghost" onclick="delPrayer('${p.id}')">Apagar</button>
        </div>
      </div>
    `).join('');
  }

  // ---------- Notes ----------
  function getNotes(){ return store.get('notes', []); }
  function setNotes(arr){ store.set('notes', arr); renderNotes(); }
  function addNote(){
    const title = document.getElementById('noteTitle').value.trim() || "Sem t√≠tulo";
    const text = document.getElementById('noteText').value.trim();
    const arr = getNotes();
    arr.unshift({id: crypto.randomUUID(), title, text, date: new Date().toISOString()});
    setNotes(arr);
    document.getElementById('noteTitle').value="";
    document.getElementById('noteText').value="";
    toast("Nota salva üìù");
  }
  function delNote(id){
    if (!confirm("Apagar esta nota?")) return;
    setNotes(getNotes().filter(n=>n.id!==id));
  }
  function renderNotes(){
    const el = document.getElementById('noteList');
    const arr = getNotes();
    if (!arr.length){ el.innerHTML = `<div class="item"><b>Nenhuma nota ainda</b><div class="tiny">Use como seu caderno espiritual.</div></div>`; return; }
    el.innerHTML = arr.map(n=>`
      <div class="item">
        <div class="row">
          <div class="left">
            <b>${esc(n.title)}</b>
            <span>${new Date(n.date).toLocaleString()}</span>
          </div>
          <button class="ghost" onclick="delNote('${n.id}')">Apagar</button>
        </div>
        ${n.text ? `<div class="tiny" style="margin-top:10px; white-space:pre-wrap">${esc(n.text)}</div>` : ''}
      </div>
    `).join('');
  }

  // ---------- Backup ----------
  function exportData(){
    const payload = {
      version: 1,
      exportedAt: new Date().toISOString(),
      notes: getNotes(),
      prayers: getPrayers(),
      plan: getPlan(),
      verseIndex
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup-app-cristao-${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
    toast("Backup gerado ‚úÖ");
  }
  async function importData(file){
    if (!file) return;
    const text = await file.text();
    try{
      const data = JSON.parse(text);
      if (data.notes) setNotes(data.notes);
      if (data.prayers) setPrayers(data.prayers);
      if (data.plan) setPlan(data.plan);
      if (typeof data.verseIndex === 'number') { verseIndex = data.verseIndex; renderVerse(); }
      toast("Importado ‚úÖ");
    }catch{
      alert("Arquivo inv√°lido.");
    }
    document.getElementById('importFile').value = "";
  }
  function wipeAll(){
    if (!confirm("Tem certeza que quer apagar tudo?")) return;
    localStorage.clear();
    location.reload();
  }

  // ---------- UI ----------
  function show(which){
    const views = ['hoje','oracao','notas','config'];
    for (const v of views){
      document.getElementById('view-'+v).style.display = (v===which) ? 'block' : 'none';
      document.getElementById('tab-'+v).classList.toggle('active', v===which);
    }
  }
  function esc(s){ return (s??'').toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

  // Tiny toast
  let toastTimer=null;
  function toast(msg){
    const pill = document.getElementById('statusPill');
    pill.textContent = "‚úÖ " + msg;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> updateStatus(), 1400);
  }
  function updateStatus(){
    const p = getPlan();
    const i = todayIndex();
    const ok = p.done.includes(i);
    document.getElementById('statusPill').textContent = ok ? "üü¢ Dia em dia" : "üü° Pend√™ncia hoje";
  }

  // Init
  setVerseByDay();
  renderPlan();
  renderPrayers();
  renderNotes();
  updateStatus();
</script>
</body>
</html>
